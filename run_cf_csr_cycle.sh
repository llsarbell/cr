#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ —Å–±–æ—Ä–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ CF"
echo "============================================"

# 1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É —Å–∫—Ä–∏–ø—Ç–∞ (–∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞)
cd "$(dirname "$0")" || exit

# 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–°–∫–∞—á–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è)
echo ""
echo "üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å GitHub..."
# –ü—Ä—è—á–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏, –æ–±–Ω–æ–≤–ª—è–µ–º—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–∞–≤–∫–∏
git stash
git pull --rebase origin main
git stash pop 2>/dev/null

# 3. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ CF
echo ""
echo "üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤..."
rm -f screenshots/cf_*.png

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º Puppeteer
echo ""
echo "üì∏ –°–±–æ—Ä —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤..."
node capture_cf.mjs

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –≤ JS —Å–∫—Ä–∏–ø—Ç–µ"
    exit 1
fi

# 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Git
echo ""
echo "üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ GitHub..."

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
git add screenshots/cf_*.png

# –ö–æ–º–º–∏—Ç–∏–º (–µ—Å–ª–∏ –µ—Å—Ç—å —á—Ç–æ)
TIMESTAMP=$(date '+%Y-%m-%dT%H:%M:%S')
git commit -m "Update CF screenshots - $TIMESTAMP"

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
git push origin main

echo ""
echo "‚úÖ –ì–û–¢–û–í–û!"

#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è TradingView"
echo "============================================"

# 1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É —Å–∫—Ä–∏–ø—Ç–∞
cd "$(dirname "$0")" || exit

# 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
echo ""
echo "üîÑ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è..."
git stash
git pull --rebase origin main
git stash pop 2>/dev/null

# 3. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (–ø—Ä–µ–¥—ã–¥—É—â–∏–π –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–µ–π–º–∏–Ω–≥)
rm -f screenshots/06_*.png

# 4. –ó–∞–ø—É—Å–∫ Puppeteer
echo ""
echo "üì∏ –ó–∞–ø—É—Å–∫ Puppeteer (TV)..."
node capture_tv.mjs

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –≤ JS —Å–∫—Ä–∏–ø—Ç–µ"
    exit 1
fi

# 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Git
echo ""
echo "üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –≤ GitHub..."

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã (–æ–Ω–∏ —Ç–µ–ø–µ—Ä—å –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Ç–∞–∫ –∂–µ 06_tv_cf_..., —Ç–∞–∫ —á—Ç–æ –º–∞—Å–∫–∞ 06_* —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)
# –ù–æ —á—Ç–æ–±—ã Git –ø–æ–Ω—è–ª, —á—Ç–æ –º—ã —É–¥–∞–ª–∏–ª–∏ —Å—Ç–∞—Ä—ã–µ –∏–º–µ–Ω–∞ –∏ —Å–æ–∑–¥–∞–ª–∏ –Ω–æ–≤—ã–µ, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å add . –∏–ª–∏ add -u
git add screenshots/06_*.png

TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
git commit -m "Update TV charts (rename) - $TIMESTAMP"

git push origin main

echo ""
echo "‚úÖ TV-—Å–∫—Ä–∏–Ω—à–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!"
